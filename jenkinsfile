pipeline {
  agent any
  tools {
    maven 'Maven-3.8'   // match name in Jenkins Global Tool Config
    jdk 'JDK11'         // match name in Jenkins Global Tool Config
  }
  stages {
    stage('Checkout') {
      steps { checkout scm }
    }
    stage('Build') {
      steps {
        bat 'mvn -B clean package'
      }
    }
    stage('Verify JAR') {
      steps {
        bat 'jar tf target/hello-1.0-SNAPSHOT.jar || true'
        bat 'echo "Main-Class from manifest:"; jar xf target/hello-1.0-SNAPSHOT.jar META-INF/MANIFEST.MF || true; cat META-INF/MANIFEST.MF || true; rm -rf META-INF || true'
      }
    }
    stage('Archive') {
      steps {
        archiveArtifacts artifacts: 'target/*.jar', fingerprint: true
      }
    }
  }
  post {
    success { echo "Build successful: ${env.BUILD_URL}" }
    failure { echo "Build failed â€” check console output" }
  }
}
