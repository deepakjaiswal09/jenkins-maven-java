pipeline {
  agent {
    docker {
      image 'maven:3.8.6-jdk-11'   // official image containing mvn + JDK 11
      args '-v /root/.m2:/root/.m2' // cache maven repo between builds (optional)
    }
  }

  stages {
    stage('Checkout') {
      steps { checkout scm }
    }

    stage('Build') {
      steps {
        // inside container: mvn is available
        sh 'mvn -B clean package'
      }
    }

    stage('Verify JAR') {
      steps {
        sh 'jar tf target/hello-1.0-SNAPSHOT.jar || true'
        sh 'echo "Main-Class from manifest:"; jar xf target/hello-1.0-SNAPSHOT.jar META-INF/MANIFEST.MF || true; cat META-INF/MANIFEST.MF || true; rm -rf META-INF || true'
      }
    }

    stage('Archive') {
      steps {
        archiveArtifacts artifacts: 'target/*.jar', fingerprint: true
      }
    }
  }

  post {
    success { echo "Build successful: ${env.BUILD_URL}" }
    failure { echo "Build failed â€” check console output" }
  }
}
